import{j as e}from"./ui-C--pN7N1.js";import{b as O,u as B}from"./router-CF8zxTMD.js";import{b as F,c as w,u as L}from"./query-8bG1UgkI.js";import{u as I,B as c,a as T,C as x,e as u,f as p,g as j,h as N}from"./index-BHAYH_9x.js";import{B as D}from"./badge-Dfpj_YoU.js";import{a as h}from"./api-BrMLtf3-.js";import{e as y,j as E,C as R,i as S}from"./icons-BG5vJQy4.js";import"./vendor-CbTYwD9p.js";function V(){const{quizId:n}=O(),[,b]=B(),{toast:g}=I(),v=F(),{data:d,isLoading:z}=w({queryKey:["/api/quizzes",n],queryFn:async()=>{console.log("Fetching quiz data for quizId:",n);const s=await h(`/api/quizzes/${n}`);if(!s.ok)throw new Error("Failed to fetch quiz");const t=await s.json();return console.log("Quiz data fetched:",t),t},enabled:!!n}),{data:a,isLoading:C}=w({queryKey:["/api/quizzes",n,"latest-attempt"],queryFn:async()=>{console.log("Fetching attempt data for quizId:",n);const s=await h(`/api/quizzes/${n}/latest-attempt`);if(!s.ok)throw new Error("Failed to fetch quiz attempt");const t=await s.json();return console.log("Attempt data fetched:",t),t},enabled:!!n}),m=L({mutationFn:async s=>{const t=await h(`/api/quizzes/${s}/regenerate`,{method:"POST"});if(!t.ok)throw new Error("Failed to regenerate quiz");return t.json()},onSuccess:s=>{v.invalidateQueries({queryKey:["/api/quizzes",n]}),g({title:"Quiz Regenerated!",description:"New questions have been generated for better learning."}),b(`/quiz/${n}`)},onError:s=>{console.error("Failed to regenerate quiz:",s);const t=s instanceof Error?s.message:"Unknown error",r=t.includes("quota")||t.includes("limit");g({title:"Regeneration Failed",description:r?"API quota exceeded. Please try again tomorrow or upgrade your plan.":"Could not generate new questions. Please try again.",variant:"destructive"})}}),A=()=>{n&&m.mutate(n)};if(z||C)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading quiz results..."})});if(!d||!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Quiz Results Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The quiz or your attempt results could not be found."}),e.jsxs(c,{onClick:()=>window.location.href="/dashboard",className:"hover:shadow-lg transition-all duration-200",children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]})});const k=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",Q=s=>s>=80?"default":s>=60?"secondary":"destructive";return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"linear-gradient(135deg, #B6E2D3 0%, #BDBFA3 50%, #B6E2D3 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-20 left-10 w-16 h-16 rounded-full",style:{backgroundColor:"#61C2A2"}}),e.jsx("div",{className:"absolute top-32 right-20 w-12 h-12 rounded-full",style:{backgroundColor:"#09224E"}}),e.jsx("div",{className:"absolute bottom-20 left-1/4 w-20 h-20 rounded-full",style:{backgroundColor:"#BDBFA3"}}),e.jsx("div",{className:"absolute bottom-32 right-1/3 w-14 h-14 rounded-full",style:{backgroundColor:"#61C2A2"}})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("header",{className:"shadow-sm",style:{backgroundColor:"#61C2A2"},children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard",className:"text-white hover:bg-white/20",children:e.jsx(y,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(T,{size:"md"}),e.jsx("h1",{className:"text-xl font-semibold text-white",children:"ClariTA"})]}),e.jsx("span",{className:"text-sm text-white/90 bg-white/20 px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(x,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),d.name||"Quiz Results"]}),e.jsxs(j,{children:["Completed on ",new Date(a.completedAt).toLocaleDateString()," at ",new Date(a.completedAt).toLocaleTimeString()]})]})}),e.jsxs(x,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[e.jsx(u,{children:e.jsx(p,{children:"Quiz Complete!"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold ${k(a.percentage)}`,children:[a.percentage,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-foreground",children:[a.score,"/",a.totalQuestions]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(D,{variant:Q(a.percentage),className:"text-lg px-4 py-2",children:a.percentage>=80?"Excellent!":a.percentage>=60?"Good Job!":"Keep Practicing!"})})]})]}),e.jsxs(x,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Answer Key"}),e.jsx(j,{children:"Review your answers and explanations"})]}),e.jsx(N,{children:e.jsx("div",{className:"space-y-6",children:d.questions.map((s,t)=>{var f;const r=a.answers.find(i=>i.questionId===s.id);return r?(s.type==="mcq"&&console.log(`Question ${t+1}:`,{id:s.id,type:s.type,options:s.options,optionsLength:(f=s.options)==null?void 0:f.length,userAnswer:r.userAnswer,userAnswerType:typeof r.userAnswer,correctAnswer:s.answer,correctAnswerType:typeof s.answer,userAnswerText:s.options&&s.options.length>0?s.options[r.userAnswer]:"NO OPTIONS",correctAnswerText:s.options&&s.options.length>0?s.options[s.answer]:"NO OPTIONS"}),e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[r.isCorrect?e.jsx(R,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(S,{className:"h-5 w-5 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-foreground mb-2",children:["Question ",t+1,": ",s.prompt]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Your Answer:"}),e.jsx("span",{className:`px-2 py-1 rounded ${r.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(()=>{var i;if(console.log("Rendering user answer for question:",s.id,{type:s.type,userAnswer:r.userAnswer,options:s.options,optionsLength:(i=s.options)==null?void 0:i.length}),s.type==="mcq")if(s.options&&s.options.length>0){const o=r.userAnswer;if(o>=0&&o<s.options.length){const l=s.options[o];return console.log("Selected option:",l,"for index:",o),l}else return`Option ${o+1} (Invalid Index)`}else return`Option ${r.userAnswer+1} (Options Missing)`;return String(r.userAnswer)})()})]}),!r.isCorrect&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Correct Answer:"}),e.jsx("span",{className:"px-2 py-1 rounded bg-green-100 text-green-800",children:(()=>{var i;if(console.log("Rendering correct answer for question:",s.id,{type:s.type,correctAnswer:s.answer,options:s.options,optionsLength:(i=s.options)==null?void 0:i.length}),s.type==="mcq")if(s.options&&s.options.length>0){const o=s.answer;if(o>=0&&o<s.options.length){const l=s.options[o];return console.log("Correct option:",l,"for index:",o),l}else return`Option ${o+1} (Invalid Index)`}else return`Option ${s.answer+1} (Options Missing)`;return String(s.answer)})()})]}),e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded",children:[e.jsx("span",{className:"font-medium",children:"Explanation:"})," ",s.explanation]})]})]})]})},s.id)):null})})})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(c,{variant:"outline",onClick:A,disabled:m.isPending,children:m.isPending?"Generating...":"Retake Quiz"}),e.jsx(c,{onClick:()=>window.location.href="/dashboard",className:"hover:shadow-lg transition-all duration-200",children:"Back to Dashboard"})]})]})})]})]})}export{V as default};
