import{c as U,u as V,j as e,d as T,e as F,f as le,F as de,G as ue,p as J,q as me,m as xe,r as pe,I as fe}from"./ui-D6VjsBYi.js";import{b as he,u as be}from"./router-CF8zxTMD.js";import{u as je,c as ge}from"./query-BZa0afV1.js";import{r as p}from"./vendor-CbTYwD9p.js";import{c as Y,C as z,T as ve,a as Ne,B as w,b as ye,L as I,I as we,u as Re}from"./index-CmxvTInv.js";import{k as Ce,Q as ke,j as Q,G as D,b as ze,l as Se}from"./icons-DYmPzIeJ.js";import{a as K}from"./api-KDl3zqcO.js";var A="Radio",[Ie,H]=U(A),[Qe,Fe]=Ie(A),W=p.forwardRef((s,c)=>{const{__scopeRadio:t,name:l,checked:n=!1,required:m,disabled:d,value:o="on",onCheck:u,form:g,...r}=s,[h,v]=p.useState(null),f=V(c,N=>v(N)),b=p.useRef(!1),y=h?g||!!h.closest("form"):!0;return e.jsxs(Qe,{scope:t,checked:n,disabled:d,children:[e.jsx(T.button,{type:"button",role:"radio","aria-checked":n,"data-state":ee(n),"data-disabled":d?"":void 0,disabled:d,value:o,...r,ref:f,onClick:F(s.onClick,N=>{n||u==null||u(),y&&(b.current=N.isPropagationStopped(),b.current||N.stopPropagation())})}),y&&e.jsx(Ee,{control:h,bubbles:!b.current,name:l,value:o,checked:n,required:m,disabled:d,form:g,style:{transform:"translateX(-100%)"}})]})});W.displayName=A;var X="RadioIndicator",Z=p.forwardRef((s,c)=>{const{__scopeRadio:t,forceMount:l,...n}=s,m=Fe(X,t);return e.jsx(le,{present:l||m.checked,children:e.jsx(T.span,{"data-state":ee(m.checked),"data-disabled":m.disabled?"":void 0,...n,ref:c})})});Z.displayName=X;var Ee=s=>{const{control:c,checked:t,bubbles:l=!0,...n}=s,m=p.useRef(null),d=de(t),o=ue(c);return p.useEffect(()=>{const u=m.current,g=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(g,"checked").set;if(d!==t&&h){const v=new Event("click",{bubbles:l});h.call(u,t),u.dispatchEvent(v)}},[d,t,l]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:t,...n,tabIndex:-1,ref:m,style:{...s.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ee(s){return s?"checked":"unchecked"}var Te=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],P="RadioGroup",[Ae,Ve]=U(P,[J,H]),se=J(),te=H(),[Pe,Ge]=Ae(P),re=p.forwardRef((s,c)=>{const{__scopeRadioGroup:t,name:l,defaultValue:n,value:m,required:d=!1,disabled:o=!1,orientation:u,dir:g,loop:r=!0,onValueChange:h,...v}=s,f=se(t),b=me(g),[y,N]=xe({prop:m,defaultProp:n,onChange:h});return e.jsx(Pe,{scope:t,name:l,required:d,disabled:o,value:y,onValueChange:N,children:e.jsx(pe,{asChild:!0,...f,orientation:u,dir:b,loop:r,children:e.jsx(T.div,{role:"radiogroup","aria-required":d,"aria-orientation":u,"data-disabled":o?"":void 0,dir:b,...v,ref:c})})})});re.displayName=P;var ae="RadioGroupItem",oe=p.forwardRef((s,c)=>{const{__scopeRadioGroup:t,disabled:l,...n}=s,m=Ge(ae,t),d=m.disabled||l,o=se(t),u=te(t),g=p.useRef(null),r=V(c,g),h=m.value===n.value,v=p.useRef(!1);return p.useEffect(()=>{const f=y=>{Te.includes(y.key)&&(v.current=!0)},b=()=>v.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",b)}},[]),e.jsx(fe,{asChild:!0,...o,focusable:!d,active:h,children:e.jsx(W,{disabled:d,required:m.required,checked:h,...u,...n,name:m.name,ref:r,onCheck:()=>m.onValueChange(n.value),onKeyDown:F(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:F(n.onFocus,()=>{var f;v.current&&((f=g.current)==null||f.click())})})})});oe.displayName=ae;var $e="RadioGroupIndicator",ne=p.forwardRef((s,c)=>{const{__scopeRadioGroup:t,...l}=s,n=te(t);return e.jsx(Z,{...n,...l,ref:c})});ne.displayName=$e;var ie=re,ce=oe,Le=ne;const E=p.forwardRef(({className:s,...c},t)=>e.jsx(ie,{className:Y("grid gap-2",s),...c,ref:t}));E.displayName=ie.displayName;const S=p.forwardRef(({className:s,...c},t)=>e.jsx(ce,{ref:t,className:Y("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...c,children:e.jsx(Le,{className:"flex items-center justify-center",children:e.jsx(Ce,{className:"h-2.5 w-2.5 fill-current text-current"})})}));S.displayName=ce.displayName;function _e({question:s,questionNumber:c,totalQuestions:t,userAnswer:l,onAnswerChange:n}){const d=(o=>{switch(o){case"mcq":return{label:"MCQ",color:"bg-blue-100 text-blue-800"};case"tf":return{label:"T/F",color:"bg-purple-100 text-purple-800"};case"fill":return{label:"Fill",color:"bg-orange-100 text-orange-800"};default:return{label:"Unknown",color:"bg-gray-100 text-gray-800"}}})(s.type);return s.answer,e.jsxs(z,{className:"p-6 fade-in","data-testid":`card-question-${s.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${d.color}`,children:d.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Question ",c," of ",t]})]}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-4","data-testid":`text-prompt-${s.id}`,children:s.prompt})]}),e.jsxs(ve,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon","data-testid":`button-citations-${s.id}`,children:e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(ye,{className:"max-w-xs",children:e.jsxs("div",{children:[e.jsx("strong",{children:"Citations:"}),s.citations.map((o,u)=>e.jsxs("div",{className:"mt-1",children:["Page ",o.page,': "',o.snippet,'"']},u))]})})]})]}),s.type==="mcq"&&s.options&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsx(E,{value:typeof l=="number"?l.toString():void 0,onValueChange:o=>n(parseInt(o)),children:s.options.map((o,u)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(S,{value:u.toString(),id:`${s.id}-${u}`}),e.jsx(I,{htmlFor:`${s.id}-${u}`,className:"flex-1 cursor-pointer",children:o})]},u))})}),s.type==="tf"&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsxs(E,{value:typeof l=="boolean"?l.toString():void 0,onValueChange:o=>n(o==="true"),children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(S,{value:"true",id:`${s.id}-true`}),e.jsx(I,{htmlFor:`${s.id}-true`,className:"flex-1 cursor-pointer",children:"True"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(S,{value:"false",id:`${s.id}-false`}),e.jsx(I,{htmlFor:`${s.id}-false`,className:"flex-1 cursor-pointer",children:"False"})]})]})}),s.type==="fill"&&e.jsx("div",{className:"mb-4",children:e.jsx(we,{placeholder:"Fill in the blank...",value:typeof l=="string"?l:"",onChange:o=>n(o.target.value),className:"w-full"})})]})}function Je(){var $,L,_,O,q,M;const{quizId:s}=he(),[,c]=be(),[t,l]=p.useState({}),[n,m]=p.useState(!1),[d,o]=p.useState(null),{toast:u}=Re(),g=je({mutationFn:async a=>{console.log("Saving quiz attempt:",a);const x=await K("/api/quiz-attempts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!x.ok){let j;try{j=await x.text()}catch{j="Unknown error"}throw console.error("Failed to save quiz attempt:",x.status,j),new Error(`Failed to save quiz attempt: ${x.status} - ${j}`)}let i;try{i=await x.json(),console.log("Quiz attempt saved successfully:",i)}catch(j){throw console.error("Failed to parse response as JSON:",j),new Error("Invalid response format from server")}return i},onSuccess:a=>{console.log("Quiz attempt saved successfully:",a)},onError:a=>{console.error("Failed to save quiz attempt:",a),u({title:"Warning",description:"Quiz completed but results may not be saved properly.",variant:"destructive"})}}),{data:r,isLoading:h,error:v}=ge({queryKey:["/api/quizzes",s],queryFn:async()=>{const a=await K(`/api/quizzes/${s}`);if(!a.ok)throw new Error("Failed to fetch quiz");return a.json()},enabled:!!s}),f=(a,x)=>{l(i=>({...i,[a]:x}))},b=()=>{if(!r)return;if(Object.keys(t).length<r.questions.length){u({title:"Incomplete Quiz",description:`Please answer all ${r.questions.length} questions before submitting.`,variant:"destructive"});return}let x=0;const i=r.questions.map(R=>{const C=t[R.id];let k;return R.type==="fill"&&typeof C=="string"&&typeof R.answer=="string"?k=C.toLowerCase().trim()===R.answer.toLowerCase().trim():k=JSON.stringify(C)===JSON.stringify(R.answer),k&&x++,{questionId:R.id,userAnswer:C,correctAnswer:R.answer,isCorrect:k}}),j=Math.round(x/r.questions.length*100),B={score:x,totalQuestions:r.questions.length,percentage:j,answers:i};o(B),m(!0),g.mutate({quizId:r.quizId,score:x,totalQuestions:r.questions.length,percentage:j,answers:i}),u({title:"Quiz Submitted!",description:`You scored ${x}/${r.questions.length} (${j}%)`})},y=()=>{l({}),m(!1),o(null)};if(h)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading quiz..."})]})});if(v||!r)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(z,{className:"p-6 max-w-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Quiz Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The quiz you're looking for doesn't exist or has been removed."}),e.jsxs(w,{onClick:()=>c("/"),"data-testid":"button-back-home",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Back to Upload"]})]})})});const N=Object.keys(t).length,G=N===r.questions.length;return n&&d?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>c("/dashboard"),"data-testid":"button-back",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(z,{className:"p-6 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Quiz Complete!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-primary",children:[d.percentage,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-foreground",children:[d.score,"/",d.totalQuestions]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(w,{onClick:y,variant:"outline",children:"Retake Quiz"}),e.jsx(w,{onClick:()=>c("/dashboard"),children:"Back to Dashboard"})]})]})}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Answer Key"}),e.jsx("div",{className:"space-y-4",children:r.questions.map((a,x)=>{const i=d.answers.find(j=>j.questionId===a.id);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-foreground",children:["Question ",x+1]}),i!=null&&i.isCorrect?e.jsx(ze,{className:"h-5 w-5 text-green-500"}):e.jsx(Se,{className:"h-5 w-5 text-red-500"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:a.prompt}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Your Answer:"}),e.jsx("p",{className:`${i!=null&&i.isCorrect?"text-green-600":"text-red-600"}`,children:typeof(i==null?void 0:i.userAnswer)=="boolean"?i.userAnswer?"True":"False":(i==null?void 0:i.userAnswer)||"No answer"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Correct Answer:"}),e.jsx("p",{className:"text-green-600",children:typeof a.answer=="boolean"?a.answer?"True":"False":a.answer})]})]}),a.explanation&&e.jsx("div",{className:"mt-3 p-3 bg-muted rounded",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Explanation:"})," ",a.explanation]})})]},a.id)})})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>c("/dashboard"),"data-testid":"button-back",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[N,"/",r.questions.length," answered"]}),e.jsx(w,{onClick:b,disabled:!G,className:"min-w-[100px]",children:"Submit Quiz"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-2",children:"Quiz"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.questions.length," questions â€¢ ",((L=($=r.meta)==null?void 0:$.countsByType)==null?void 0:L.mcq)||0," MCQ, ",((O=(_=r.meta)==null?void 0:_.countsByType)==null?void 0:O.tf)||0," True/False, ",((M=(q=r.meta)==null?void 0:q.countsByType)==null?void 0:M.fill)||0," Fill in the Blank"]})]}),e.jsx("div",{className:"space-y-6",children:r.questions.map((a,x)=>e.jsx(_e,{question:a,questionNumber:x+1,totalQuestions:r.questions.length,userAnswer:t[a.id],onAnswerChange:i=>f(a.id,i)},a.id))}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs(w,{onClick:b,disabled:!G,size:"lg",className:"min-w-[200px]",children:["Submit Quiz (",N,"/",r.questions.length,")"]})})]})]})}export{Je as default};
