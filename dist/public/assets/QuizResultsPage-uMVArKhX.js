import{j as e}from"./ui-D6VjsBYi.js";import{b as O,u as I}from"./router-CF8zxTMD.js";import{b as L,c as j,u as T}from"./query-BZa0afV1.js";import{u as F,B as l,C as x,d as p,e as u,f as w,g as y}from"./index-DCPyX0L0.js";import{B as R}from"./badge-BThhwP-r.js";import{a as h}from"./api-BSo0G3p6.js";import{i as N,B as S,l as P,b as $,k as B}from"./icons-BVLFyzTP.js";import"./vendor-CbTYwD9p.js";function V(){const{quizId:n}=O(),[,b]=I(),{toast:g}=F(),v=L(),{data:d,isLoading:z}=j({queryKey:["/api/quizzes",n],queryFn:async()=>{console.log("Fetching quiz data for quizId:",n);const s=await h(`/api/quizzes/${n}`);if(!s.ok)throw new Error("Failed to fetch quiz");const t=await s.json();return console.log("Quiz data fetched:",t),t},enabled:!!n}),{data:a,isLoading:C}=j({queryKey:["/api/quizzes",n,"latest-attempt"],queryFn:async()=>{console.log("Fetching attempt data for quizId:",n);const s=await h(`/api/quizzes/${n}/latest-attempt`);if(!s.ok)throw new Error("Failed to fetch quiz attempt");const t=await s.json();return console.log("Attempt data fetched:",t),t},enabled:!!n}),m=T({mutationFn:async s=>{const t=await h(`/api/quizzes/${s}/regenerate`,{method:"POST"});if(!t.ok)throw new Error("Failed to regenerate quiz");return t.json()},onSuccess:s=>{v.invalidateQueries({queryKey:["/api/quizzes",n]}),g({title:"Quiz Regenerated!",description:"New questions have been generated for better learning."}),b(`/quiz/${n}`)},onError:s=>{console.error("Failed to regenerate quiz:",s);const t=s instanceof Error?s.message:"Unknown error",r=t.includes("quota")||t.includes("limit");g({title:"Regeneration Failed",description:r?"API quota exceeded. Please try again tomorrow or upgrade your plan.":"Could not generate new questions. Please try again.",variant:"destructive"})}}),A=()=>{n&&m.mutate(n)};if(z||C)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading quiz results..."})});if(!d||!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Quiz Results Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The quiz or your attempt results could not be found."}),e.jsxs(l,{onClick:()=>window.location.href="/dashboard",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]})});const Q=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",k=s=>s>=80?"default":s>=60?"secondary":"destructive";return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard",children:e.jsx(N,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(x,{children:e.jsxs(p,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),d.name||"Quiz Results"]}),e.jsxs(w,{children:["Completed on ",new Date(a.completedAt).toLocaleDateString()," at ",new Date(a.completedAt).toLocaleTimeString()]})]})}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(u,{children:"Quiz Complete!"})}),e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold ${Q(a.percentage)}`,children:[a.percentage,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-foreground",children:[a.score,"/",a.totalQuestions]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{variant:k(a.percentage),className:"text-lg px-4 py-2",children:a.percentage>=80?"Excellent!":a.percentage>=60?"Good Job!":"Keep Practicing!"})})]})]}),e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(u,{children:"Answer Key"}),e.jsx(w,{children:"Review your answers and explanations"})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-6",children:d.questions.map((s,t)=>{var f;const r=a.answers.find(o=>o.questionId===s.id);return r?(s.type==="mcq"&&console.log(`Question ${t+1}:`,{id:s.id,type:s.type,options:s.options,optionsLength:(f=s.options)==null?void 0:f.length,userAnswer:r.userAnswer,userAnswerType:typeof r.userAnswer,correctAnswer:s.answer,correctAnswerType:typeof s.answer,userAnswerText:s.options&&s.options.length>0?s.options[r.userAnswer]:"NO OPTIONS",correctAnswerText:s.options&&s.options.length>0?s.options[s.answer]:"NO OPTIONS"}),e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[r.isCorrect?e.jsx($,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(B,{className:"h-5 w-5 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-foreground mb-2",children:["Question ",t+1,": ",s.prompt]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Your Answer:"}),e.jsx("span",{className:`px-2 py-1 rounded ${r.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(()=>{var o;if(console.log("Rendering user answer for question:",s.id,{type:s.type,userAnswer:r.userAnswer,options:s.options,optionsLength:(o=s.options)==null?void 0:o.length}),s.type==="mcq")if(s.options&&s.options.length>0){const i=r.userAnswer;if(i>=0&&i<s.options.length){const c=s.options[i];return console.log("Selected option:",c,"for index:",i),c}else return`Option ${i+1} (Invalid Index)`}else return`Option ${r.userAnswer+1} (Options Missing)`;return String(r.userAnswer)})()})]}),!r.isCorrect&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Correct Answer:"}),e.jsx("span",{className:"px-2 py-1 rounded bg-green-100 text-green-800",children:(()=>{var o;if(console.log("Rendering correct answer for question:",s.id,{type:s.type,correctAnswer:s.answer,options:s.options,optionsLength:(o=s.options)==null?void 0:o.length}),s.type==="mcq")if(s.options&&s.options.length>0){const i=s.answer;if(i>=0&&i<s.options.length){const c=s.options[i];return console.log("Correct option:",c,"for index:",i),c}else return`Option ${i+1} (Invalid Index)`}else return`Option ${s.answer+1} (Options Missing)`;return String(s.answer)})()})]}),e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded",children:[e.jsx("span",{className:"font-medium",children:"Explanation:"})," ",s.explanation]})]})]})]})},s.id)):null})})})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(l,{variant:"outline",onClick:A,disabled:m.isPending,children:m.isPending?"Generating...":"Retake Quiz"}),e.jsx(l,{onClick:()=>window.location.href="/dashboard",children:"Back to Dashboard"})]})]})})]})}export{V as default};
