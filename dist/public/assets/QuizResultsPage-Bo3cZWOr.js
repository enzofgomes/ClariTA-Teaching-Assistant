import{j as e}from"./ui-D6VjsBYi.js";import{b as A,u as C}from"./router-CF8zxTMD.js";import{c as g}from"./query-BZa0afV1.js";import{B as d,C as m,d as p,e as h,f,g as j}from"./index-X69ZQDH-.js";import{B as O}from"./badge-C4faGhk4.js";import{a as w}from"./api-BnTOs7Wk.js";import{j as N,B as L,m as I,b as k,l as Q}from"./icons-6VhNX1p2.js";import"./vendor-CbTYwD9p.js";function P(){const{quizId:a}=A(),[,l]=C(),{data:x,isLoading:y}=g({queryKey:["/api/quizzes",a],queryFn:async()=>{console.log("Fetching quiz data for quizId:",a);const s=await w(`/api/quizzes/${a}`);if(!s.ok)throw new Error("Failed to fetch quiz");const i=await s.json();return console.log("Quiz data fetched:",i),i},enabled:!!a}),{data:t,isLoading:b}=g({queryKey:["/api/quizzes",a,"latest-attempt"],queryFn:async()=>{console.log("Fetching attempt data for quizId:",a);const s=await w(`/api/quizzes/${a}/latest-attempt`);if(!s.ok)throw new Error("Failed to fetch quiz attempt");const i=await s.json();return console.log("Attempt data fetched:",i),i},enabled:!!a});if(y||b)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading quiz results..."})});if(!x||!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Quiz Results Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The quiz or your attempt results could not be found."}),e.jsxs(d,{onClick:()=>l("/dashboard"),children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]})});const v=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",z=s=>s>=80?"default":s>=60?"secondary":"destructive";return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>l("/dashboard"),children:e.jsx(N,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(m,{children:e.jsxs(p,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),x.name||"Quiz Results"]}),e.jsxs(f,{children:["Completed on ",new Date(t.completedAt).toLocaleDateString()," at ",new Date(t.completedAt).toLocaleTimeString()]})]})}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(h,{children:"Quiz Complete!"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold ${v(t.percentage)}`,children:[t.percentage,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-foreground",children:[t.score,"/",t.totalQuestions]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{variant:z(t.percentage),className:"text-lg px-4 py-2",children:t.percentage>=80?"Excellent!":t.percentage>=60?"Good Job!":"Keep Practicing!"})})]})]}),e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(h,{children:"Answer Key"}),e.jsx(f,{children:"Review your answers and explanations"})]}),e.jsx(j,{children:e.jsx("div",{className:"space-y-6",children:x.questions.map((s,i)=>{var u;const r=t.answers.find(o=>o.questionId===s.id);return r?(s.type==="mcq"&&console.log(`Question ${i+1}:`,{id:s.id,type:s.type,options:s.options,optionsLength:(u=s.options)==null?void 0:u.length,userAnswer:r.userAnswer,userAnswerType:typeof r.userAnswer,correctAnswer:s.answer,correctAnswerType:typeof s.answer,userAnswerText:s.options&&s.options.length>0?s.options[r.userAnswer]:"NO OPTIONS",correctAnswerText:s.options&&s.options.length>0?s.options[s.answer]:"NO OPTIONS"}),e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[r.isCorrect?e.jsx(k,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(Q,{className:"h-5 w-5 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-foreground mb-2",children:["Question ",i+1,": ",s.prompt]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Your Answer:"}),e.jsx("span",{className:`px-2 py-1 rounded ${r.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(()=>{var o;if(console.log("Rendering user answer for question:",s.id,{type:s.type,userAnswer:r.userAnswer,options:s.options,optionsLength:(o=s.options)==null?void 0:o.length}),s.type==="mcq")if(s.options&&s.options.length>0){const n=r.userAnswer;if(n>=0&&n<s.options.length){const c=s.options[n];return console.log("Selected option:",c,"for index:",n),c}else return`Option ${n+1} (Invalid Index)`}else return`Option ${r.userAnswer+1} (Options Missing)`;return String(r.userAnswer)})()})]}),!r.isCorrect&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Correct Answer:"}),e.jsx("span",{className:"px-2 py-1 rounded bg-green-100 text-green-800",children:(()=>{var o;if(console.log("Rendering correct answer for question:",s.id,{type:s.type,correctAnswer:s.answer,options:s.options,optionsLength:(o=s.options)==null?void 0:o.length}),s.type==="mcq")if(s.options&&s.options.length>0){const n=s.answer;if(n>=0&&n<s.options.length){const c=s.options[n];return console.log("Correct option:",c,"for index:",n),c}else return`Option ${n+1} (Invalid Index)`}else return`Option ${s.answer+1} (Options Missing)`;return String(s.answer)})()})]}),e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded",children:[e.jsx("span",{className:"font-medium",children:"Explanation:"})," ",s.explanation]})]})]})]})},s.id)):null})})})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(d,{variant:"outline",onClick:()=>l(`/quiz/${a}`),children:"Retake Quiz"}),e.jsx(d,{onClick:()=>l("/dashboard"),children:"Back to Dashboard"})]})]})})]})}export{P as default};
