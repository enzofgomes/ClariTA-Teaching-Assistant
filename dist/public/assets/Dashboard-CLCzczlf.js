import{H as Ue,J as Be,j as e,K as W,L as We,M as K,N as H,Q as Ke,U as V,W as He,X as Y,Y as G,Z as Ve,$ as Ye,a0 as J,c as Ge,a1 as X,y as Je,O as Xe,u as Z,a2 as Ze,s as ea,e as aa,v as sa,w as ta,t as ee,x as ra,z as la,o as oa}from"./ui-D6VjsBYi.js";import{c as m,h as ae,i as ia,u as na,B as g,C as k,d as P,e as L,g as O,f as da,I as z,D as ca,j as ma,k as ua,l as xa,m as pa,n as ha,L as _,o as ga}from"./index-CmxvTInv.js";import{b as fa,c as $,u as M}from"./query-BZa0afV1.js";import{L as T}from"./router-CF8zxTMD.js";import{B as U}from"./badge-CCEUgbmP.js";import{r as o}from"./vendor-CbTYwD9p.js";import{n as se,o as ja,e as ya,B as q,p as Na,q as va,P as B,F as wa,r as Da,s as ba,t as Aa,u as Ca,v as Sa}from"./icons-DYmPzIeJ.js";import{a as b}from"./api-KDl3zqcO.js";const za=Ue,Ta=Be,te=o.forwardRef(({className:a,children:s,...t},l)=>e.jsxs(W,{ref:l,className:m("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...t,children:[s,e.jsx(We,{asChild:!0,children:e.jsx(se,{className:"h-4 w-4 opacity-50"})})]}));te.displayName=W.displayName;const re=o.forwardRef(({className:a,...s},t)=>e.jsx(K,{ref:t,className:m("flex cursor-default items-center justify-center py-1",a),...s,children:e.jsx(ja,{className:"h-4 w-4"})}));re.displayName=K.displayName;const le=o.forwardRef(({className:a,...s},t)=>e.jsx(H,{ref:t,className:m("flex cursor-default items-center justify-center py-1",a),...s,children:e.jsx(se,{className:"h-4 w-4"})}));le.displayName=H.displayName;const oe=o.forwardRef(({className:a,children:s,position:t="popper",...l},n)=>e.jsx(Ke,{children:e.jsxs(V,{ref:n,className:m("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,...l,children:[e.jsx(re,{}),e.jsx(He,{className:m("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(le,{})]})}));oe.displayName=V.displayName;const Ea=o.forwardRef(({className:a,...s},t)=>e.jsx(Y,{ref:t,className:m("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s}));Ea.displayName=Y.displayName;const E=o.forwardRef(({className:a,children:s,...t},l)=>e.jsxs(G,{ref:l,className:m("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ve,{children:e.jsx(ya,{className:"h-4 w-4"})})}),e.jsx(Ye,{children:s})]}));E.displayName=G.displayName;const Fa=o.forwardRef(({className:a,...s},t)=>e.jsx(J,{ref:t,className:m("-mx-1 my-1 h-px bg-muted",a),...s}));Fa.displayName=J.displayName;var ie="AlertDialog",[Ra,ss]=Ge(ie,[X]),f=X(),ne=a=>{const{__scopeAlertDialog:s,...t}=a,l=f(s);return e.jsx(ra,{...l,...t,modal:!0})};ne.displayName=ie;var ka="AlertDialogTrigger",de=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,n=f(t);return e.jsx(Je,{...n,...l,ref:s})});de.displayName=ka;var Pa="AlertDialogPortal",ce=a=>{const{__scopeAlertDialog:s,...t}=a,l=f(s);return e.jsx(la,{...l,...t})};ce.displayName=Pa;var La="AlertDialogOverlay",me=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,n=f(t);return e.jsx(Xe,{...n,...l,ref:s})});me.displayName=La;var A="AlertDialogContent",[Oa,_a]=Ra(A),$a=oa("AlertDialogContent"),ue=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,children:l,...n}=a,u=f(t),y=o.useRef(null),p=Z(s,y),C=o.useRef(null);return e.jsx(Ze,{contentName:A,titleName:xe,docsSlug:"alert-dialog",children:e.jsx(Oa,{scope:t,cancelRef:C,children:e.jsxs(ea,{role:"alertdialog",...u,...n,ref:p,onOpenAutoFocus:aa(n.onOpenAutoFocus,x=>{var N;x.preventDefault(),(N=C.current)==null||N.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[e.jsx($a,{children:l}),e.jsx(Qa,{contentRef:y})]})})})});ue.displayName=A;var xe="AlertDialogTitle",pe=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,n=f(t);return e.jsx(sa,{...n,...l,ref:s})});pe.displayName=xe;var he="AlertDialogDescription",ge=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,n=f(t);return e.jsx(ta,{...n,...l,ref:s})});ge.displayName=he;var qa="AlertDialogAction",fe=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,n=f(t);return e.jsx(ee,{...n,...l,ref:s})});fe.displayName=qa;var je="AlertDialogCancel",ye=o.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,{cancelRef:n}=_a(je,t),u=f(t),y=Z(s,n);return e.jsx(ee,{...u,...l,ref:y})});ye.displayName=je;var Qa=({contentRef:a})=>{const s=`\`${A}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${A}\` by passing a \`${he}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${A}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{var l;document.getElementById((l=a.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},Ia=ne,Ma=de,Ua=ce,Ne=me,ve=ue,we=fe,De=ye,be=pe,Ae=ge;const Ba=Ia,Wa=Ma,Ka=Ua,Ce=o.forwardRef(({className:a,...s},t)=>e.jsx(Ne,{className:m("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));Ce.displayName=Ne.displayName;const Se=o.forwardRef(({className:a,...s},t)=>e.jsxs(Ka,{children:[e.jsx(Ce,{}),e.jsx(ve,{ref:t,className:m("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));Se.displayName=ve.displayName;const ze=({className:a,...s})=>e.jsx("div",{className:m("flex flex-col space-y-2 text-center sm:text-left",a),...s});ze.displayName="AlertDialogHeader";const Te=({className:a,...s})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Te.displayName="AlertDialogFooter";const Ee=o.forwardRef(({className:a,...s},t)=>e.jsx(be,{ref:t,className:m("text-lg font-semibold",a),...s}));Ee.displayName=be.displayName;const Fe=o.forwardRef(({className:a,...s},t)=>e.jsx(Ae,{ref:t,className:m("text-sm text-muted-foreground",a),...s}));Fe.displayName=Ae.displayName;const Re=o.forwardRef(({className:a,...s},t)=>e.jsx(we,{ref:t,className:m(ae(),a),...s}));Re.displayName=we.displayName;const ke=o.forwardRef(({className:a,...s},t)=>e.jsx(De,{ref:t,className:m(ae({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));ke.displayName=De.displayName;function ts(){const{user:a,loading:s,signOut:t}=ia(),{toast:l}=na(),n=fa(),[u,y]=o.useState(""),[p,C]=o.useState("all"),[x,N]=o.useState(null),[h,v]=o.useState({name:"",folder:"",tags:""}),[Pe,S]=o.useState(!1),{data:w,isLoading:Ha}=$({queryKey:["/api/user/uploads"],retry:!1,refetchOnWindowFocus:!0,queryFn:async()=>(await b("/api/user/uploads")).json()}),{data:D,isLoading:Le}=$({queryKey:["/api/user/quizzes"],retry:!1,refetchOnWindowFocus:!0,queryFn:async()=>{const i=await(await b("/api/user/quizzes")).json();return await Promise.all(i.map(async c=>{try{console.log("Checking attempts for quiz:",c.id);const j=await b(`/api/quizzes/${c.id}/latest-attempt`);return console.log("Attempt response for quiz",c.id,":",j.ok),{...c,hasAttempts:j.ok}}catch(j){return console.log("Error checking attempts for quiz",c.id,":",j),{...c,hasAttempts:!1}}}))}}),{data:F}=$({queryKey:["/api/user/quiz-folders"],retry:!1,refetchOnWindowFocus:!0,queryFn:async()=>(await b("/api/user/quiz-folders")).json()}),R=M({mutationFn:async({quizId:r,updates:i})=>{const d=await b(`/api/quizzes/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!d.ok)throw new Error("Failed to update quiz");return d.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/user/quizzes"]}),n.invalidateQueries({queryKey:["/api/user/quiz-folders"]}),l({title:"Quiz updated successfully"}),N(null),S(!1),v({name:"",folder:"",tags:""})},onError:()=>{l({title:"Failed to update quiz",variant:"destructive"})}}),Oe=M({mutationFn:async r=>{const i=await b(`/api/quizzes/${r}`,{method:"DELETE"});if(!i.ok){const d=await i.json().catch(()=>({error:"Unknown error"}));throw new Error(d.error||"Failed to delete quiz")}return i.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/user/quizzes"]}),n.invalidateQueries({queryKey:["/api/user/quiz-folders"]}),l({title:"Quiz deleted successfully"})},onError:r=>{console.error("Delete quiz error:",r),l({title:"Failed to delete quiz",description:r.message,variant:"destructive"})}}),_e=()=>{t()},$e=r=>{var i;N(r),v({name:r.name||"",folder:r.folder||"",tags:((i=r.tags)==null?void 0:i.join(", "))||""}),S(!0)},qe=()=>{if(!x)return;const r={};h.name&&(r.name=h.name),h.folder&&(r.folder=h.folder),h.tags&&(r.tags=h.tags.split(",").map(i=>i.trim()).filter(i=>i)),R.mutate({quizId:x.id,updates:r})},Qe=r=>{Oe.mutate(r)},Ie=()=>{N(null),S(!1),v({name:"",folder:"",tags:""})},Q=(D==null?void 0:D.filter(r=>{var c,j,I;const i=!u||((c=r.name)==null?void 0:c.toLowerCase().includes(u.toLowerCase()))||((j=r.folder)==null?void 0:j.toLowerCase().includes(u.toLowerCase()))||((I=r.tags)==null?void 0:I.some(Me=>Me.toLowerCase().includes(u.toLowerCase()))),d=p==="all"||p==="uncategorized"&&!r.folder||r.folder===p;return i&&d}))||[];return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ClariTA"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(Na,{className:"h-4 w-4"}),e.jsx("span",{"data-testid":"text-user-name",children:a.fullName||a.email||"User"})]}),e.jsxs(g,{variant:"outline",onClick:_e,"data-testid":"button-logout",children:[e.jsx(va,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Welcome back!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Upload a new PDF to generate quizzes or view your quiz history."})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs(k,{children:[e.jsx(P,{children:e.jsxs(L,{className:"flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Quick Actions"]})}),e.jsx(O,{className:"space-y-3",children:e.jsx(T,{href:"/upload",children:e.jsxs(g,{className:"w-full","data-testid":"button-upload-new",children:[e.jsx(wa,{className:"h-4 w-4 mr-2"}),"Upload New PDF"]})})})]}),e.jsxs(k,{className:"mt-6",children:[e.jsx(P,{children:e.jsx(L,{children:"Your Statistics"})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Uploads"}),e.jsx("span",{className:"font-semibold","data-testid":"text-upload-count",children:(w==null?void 0:w.length)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Quizzes"}),e.jsx("span",{className:"font-semibold","data-testid":"text-quiz-count",children:(D==null?void 0:D.length)||0})]})]})})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(k,{children:[e.jsxs(P,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(L,{children:"Quiz Management"}),e.jsx(da,{children:"Manage your generated quizzes with folders, tags, and search"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Da,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(z,{placeholder:"Search quizzes by name, folder, or tags...",value:u,onChange:r=>y(r.target.value),className:"pl-10"})]}),e.jsxs(za,{value:p,onValueChange:C,children:[e.jsx(te,{className:"w-full sm:w-48",children:e.jsx(Ta,{placeholder:"Filter by folder"})}),e.jsxs(oe,{children:[e.jsx(E,{value:"all",children:"All Folders"}),e.jsx(E,{value:"uncategorized",children:"Uncategorized"}),F==null?void 0:F.map(r=>e.jsx(E,{value:r,children:r},r))]})]})]})]}),e.jsx(O,{children:Le?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading quizzes..."}):Q.length>0?e.jsx("div",{className:"space-y-4",children:Q.map(r=>{const i=w==null?void 0:w.find(d=>d.id===r.uploadId);return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(q,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:r.name||`Quiz from ${(i==null?void 0:i.fileName)||"Unknown"}`}),r.folder&&e.jsxs(U,{variant:"secondary",className:"text-xs",children:[e.jsx(ba,{className:"h-3 w-3 mr-1"}),r.folder]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["From: ",i==null?void 0:i.fileName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[Object.values(r.meta.countsByType).reduce((d,c)=>d+c,0)," questions"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Created ",new Date(r.createdAt).toLocaleDateString()]})]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:r.tags.map(d=>e.jsxs(U,{variant:"outline",className:"text-xs",children:[e.jsx(Aa,{className:"h-3 w-3 mr-1"}),d]},d))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r.hasAttempts?e.jsx(T,{href:`/quiz-results/${r.id}`,children:e.jsx(g,{variant:"outline",size:"sm",children:"View Results"})}):e.jsx(T,{href:`/quiz/${r.id}`,children:e.jsx(g,{variant:"outline",size:"sm",children:"Take Quiz"})}),e.jsxs(ca,{open:Pe&&(x==null?void 0:x.id)===r.id,onOpenChange:S,children:[e.jsx(ma,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>$e(r),children:e.jsx(Ca,{className:"h-4 w-4"})})}),e.jsxs(ua,{children:[e.jsxs(xa,{children:[e.jsx(pa,{children:"Edit Quiz"}),e.jsx(ha,{children:"Update the quiz name, folder, and tags."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"name",children:"Quiz Name"}),e.jsx(z,{id:"name",value:h.name,onChange:d=>v(c=>({...c,name:d.target.value})),placeholder:"Enter quiz name"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"folder",children:"Folder"}),e.jsx(z,{id:"folder",value:h.folder,onChange:d=>v(c=>({...c,folder:d.target.value})),placeholder:"Enter folder name"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"tags",children:"Tags (comma-separated)"}),e.jsx(z,{id:"tags",value:h.tags,onChange:d=>v(c=>({...c,tags:d.target.value})),placeholder:"e.g., database, sql, advanced"})]})]}),e.jsxs(ga,{children:[e.jsx(g,{variant:"outline",onClick:Ie,children:"Cancel"}),e.jsx(g,{onClick:qe,disabled:R.isPending,children:R.isPending?"Saving...":"Save Changes"})]})]})]}),e.jsxs(Ba,{children:[e.jsx(Wa,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(Sa,{className:"h-4 w-4 text-red-500"})})}),e.jsxs(Se,{children:[e.jsxs(ze,{children:[e.jsx(Ee,{children:"Delete Quiz"}),e.jsx(Fe,{children:"Are you sure you want to delete this quiz? This action cannot be undone."})]}),e.jsxs(Te,{children:[e.jsx(ke,{children:"Cancel"}),e.jsx(Re,{onClick:()=>Qe(r.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]},r.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:u||p!=="all"?"No quizzes found":"No quizzes yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:u||p!=="all"?"Try adjusting your search or filter criteria.":"Upload a PDF and generate your first quiz to get started."}),!u&&p==="all"&&e.jsx(T,{href:"/upload",children:e.jsxs(g,{children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Upload Your First PDF"]})})]})})]})})]})]})]})}export{ts as default};
