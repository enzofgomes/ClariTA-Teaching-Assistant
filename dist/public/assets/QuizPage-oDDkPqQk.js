import{c as J,u as Y,j as e,d as A,e as E,f as me,F as xe,G as pe,p as H,q as fe,m as he,r as ge,I as be}from"./ui-D6VjsBYi.js";import{b as je,u as ve}from"./router-CF8zxTMD.js";import{b as Ne,u as U,c as ye}from"./query-BZa0afV1.js";import{r as p}from"./vendor-CbTYwD9p.js";import{c as W,C as z,T as we,a as Ce,B as w,b as Re,L as I,I as ke,u as ze}from"./index-DCPyX0L0.js";import{j as Qe,Q as Se,i as F,G as V,b as Ie,k as Fe}from"./icons-BVLFyzTP.js";import{a as P}from"./api-BSo0G3p6.js";var q="Radio",[Pe,X]=J(q),[Ee,Te]=Pe(q),Z=p.forwardRef((s,x)=>{const{__scopeRadio:a,name:l,checked:i=!1,required:m,disabled:u,value:n="on",onCheck:c,form:g,...y}=s,[r,b]=p.useState(null),f=Y(x,v=>b(v)),j=p.useRef(!1),N=r?g||!!r.closest("form"):!0;return e.jsxs(Ee,{scope:a,checked:i,disabled:u,children:[e.jsx(A.button,{type:"button",role:"radio","aria-checked":i,"data-state":te(i),"data-disabled":u?"":void 0,disabled:u,value:n,...y,ref:f,onClick:E(s.onClick,v=>{i||c==null||c(),N&&(j.current=v.isPropagationStopped(),j.current||v.stopPropagation())})}),N&&e.jsx(Ae,{control:r,bubbles:!j.current,name:l,value:n,checked:i,required:m,disabled:u,form:g,style:{transform:"translateX(-100%)"}})]})});Z.displayName=q;var ee="RadioIndicator",se=p.forwardRef((s,x)=>{const{__scopeRadio:a,forceMount:l,...i}=s,m=Te(ee,a);return e.jsx(me,{present:l||m.checked,children:e.jsx(A.span,{"data-state":te(m.checked),"data-disabled":m.disabled?"":void 0,...i,ref:x})})});se.displayName=ee;var Ae=s=>{const{control:x,checked:a,bubbles:l=!0,...i}=s,m=p.useRef(null),u=xe(a),n=pe(x);return p.useEffect(()=>{const c=m.current,g=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(g,"checked").set;if(u!==a&&r){const b=new Event("click",{bubbles:l});r.call(c,a),c.dispatchEvent(b)}},[u,a,l]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:m,style:{...s.style,...n,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function te(s){return s?"checked":"unchecked"}var qe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],G="RadioGroup",[Ge,He]=J(G,[H,X]),re=H(),ae=X(),[$e,Le]=Ge(G),oe=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,name:l,defaultValue:i,value:m,required:u=!1,disabled:n=!1,orientation:c,dir:g,loop:y=!0,onValueChange:r,...b}=s,f=re(a),j=fe(g),[N,v]=he({prop:m,defaultProp:i,onChange:r});return e.jsx($e,{scope:a,name:l,required:u,disabled:n,value:N,onValueChange:v,children:e.jsx(ge,{asChild:!0,...f,orientation:c,dir:j,loop:y,children:e.jsx(A.div,{role:"radiogroup","aria-required":u,"aria-orientation":c,"data-disabled":n?"":void 0,dir:j,...b,ref:x})})})});oe.displayName=G;var ne="RadioGroupItem",ie=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,disabled:l,...i}=s,m=Le(ne,a),u=m.disabled||l,n=re(a),c=ae(a),g=p.useRef(null),y=Y(x,g),r=m.value===i.value,b=p.useRef(!1);return p.useEffect(()=>{const f=N=>{qe.includes(N.key)&&(b.current=!0)},j=()=>b.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",j),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",j)}},[]),e.jsx(be,{asChild:!0,...n,focusable:!u,active:r,children:e.jsx(Z,{disabled:u,required:m.required,checked:r,...c,...i,name:m.name,ref:y,onCheck:()=>m.onValueChange(i.value),onKeyDown:E(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:E(i.onFocus,()=>{var f;b.current&&((f=g.current)==null||f.click())})})})});ie.displayName=ne;var _e="RadioGroupIndicator",ce=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,...l}=s,i=ae(a);return e.jsx(se,{...i,...l,ref:x})});ce.displayName=_e;var de=oe,le=ie,Oe=ce;const T=p.forwardRef(({className:s,...x},a)=>e.jsx(de,{className:W("grid gap-2",s),...x,ref:a}));T.displayName=de.displayName;const Q=p.forwardRef(({className:s,...x},a)=>e.jsx(le,{ref:a,className:W("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...x,children:e.jsx(Oe,{className:"flex items-center justify-center",children:e.jsx(Qe,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Q.displayName=le.displayName;function Me({question:s,questionNumber:x,totalQuestions:a,userAnswer:l,onAnswerChange:i}){const u=(n=>{switch(n){case"mcq":return{label:"MCQ",color:"bg-blue-100 text-blue-800"};case"tf":return{label:"T/F",color:"bg-purple-100 text-purple-800"};case"fill":return{label:"Fill",color:"bg-orange-100 text-orange-800"};default:return{label:"Unknown",color:"bg-gray-100 text-gray-800"}}})(s.type);return s.answer,e.jsxs(z,{className:"p-6 fade-in","data-testid":`card-question-${s.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${u.color}`,children:u.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Question ",x," of ",a]})]}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-4","data-testid":`text-prompt-${s.id}`,children:s.prompt})]}),e.jsxs(we,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon","data-testid":`button-citations-${s.id}`,children:e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(Re,{className:"max-w-xs",children:e.jsxs("div",{children:[e.jsx("strong",{children:"Citations:"}),s.citations.map((n,c)=>e.jsxs("div",{className:"mt-1",children:["Page ",n.page,': "',n.snippet,'"']},c))]})})]})]}),s.type==="mcq"&&s.options&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsx(T,{value:typeof l=="number"?l.toString():void 0,onValueChange:n=>i(parseInt(n)),children:s.options.map((n,c)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:c.toString(),id:`${s.id}-${c}`}),e.jsx(I,{htmlFor:`${s.id}-${c}`,className:"flex-1 cursor-pointer",children:n})]},c))})}),s.type==="tf"&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsxs(T,{value:typeof l=="boolean"?l.toString():void 0,onValueChange:n=>i(n==="true"),children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:"true",id:`${s.id}-true`}),e.jsx(I,{htmlFor:`${s.id}-true`,className:"flex-1 cursor-pointer",children:"True"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:"false",id:`${s.id}-false`}),e.jsx(I,{htmlFor:`${s.id}-false`,className:"flex-1 cursor-pointer",children:"False"})]})]})}),s.type==="fill"&&e.jsx("div",{className:"mb-4",children:e.jsx(ke,{placeholder:"Fill in the blank...",value:typeof l=="string"?l:"",onChange:n=>i(n.target.value),className:"w-full"})})]})}function We(){var L,_,O,M,B,D;const{quizId:s}=je(),[,x]=ve(),[a,l]=p.useState({}),[i,m]=p.useState(!1),[u,n]=p.useState(null),{toast:c}=ze(),g=Ne(),y=U({mutationFn:async t=>{console.log("Saving quiz attempt:",t);const d=await P("/api/quiz-attempts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!d.ok){let h;try{h=await d.text()}catch{h="Unknown error"}throw console.error("Failed to save quiz attempt:",d.status,h),new Error(`Failed to save quiz attempt: ${d.status} - ${h}`)}let o;try{o=await d.json(),console.log("Quiz attempt saved successfully:",o)}catch(h){throw console.error("Failed to parse response as JSON:",h),new Error("Invalid response format from server")}return o},onSuccess:t=>{console.log("Quiz attempt saved successfully:",t)},onError:t=>{console.error("Failed to save quiz attempt:",t),c({title:"Warning",description:"Quiz completed but results may not be saved properly.",variant:"destructive"})}}),{data:r,isLoading:b,error:f}=ye({queryKey:["/api/quizzes",s],queryFn:async()=>{const t=await P(`/api/quizzes/${s}`);if(!t.ok)throw new Error("Failed to fetch quiz");return t.json()},enabled:!!s}),j=(t,d)=>{l(o=>({...o,[t]:d}))},N=()=>{if(!r)return;if(Object.keys(a).length<r.questions.length){c({title:"Incomplete Quiz",description:`Please answer all ${r.questions.length} questions before submitting.`,variant:"destructive"});return}let d=0;const o=r.questions.map(C=>{const R=a[C.id];let k;return C.type==="fill"&&typeof R=="string"&&typeof C.answer=="string"?k=R.toLowerCase().trim()===C.answer.toLowerCase().trim():k=JSON.stringify(R)===JSON.stringify(C.answer),k&&d++,{questionId:C.id,userAnswer:R,correctAnswer:C.answer,isCorrect:k}}),h=Math.round(d/r.questions.length*100),K={score:d,totalQuestions:r.questions.length,percentage:h,answers:o};n(K),m(!0),y.mutate({quizId:r.quizId,score:d,totalQuestions:r.questions.length,percentage:h,answers:o}),c({title:"Quiz Submitted!",description:`You scored ${d}/${r.questions.length} (${h}%)`})},v=U({mutationFn:async t=>{const d=await P(`/api/quizzes/${t}/regenerate`,{method:"POST"});if(!d.ok)throw new Error("Failed to regenerate quiz");return d.json()},onSuccess:t=>{l({}),m(!1),n(null),g.invalidateQueries({queryKey:["/api/quizzes",s]}),c({title:"Quiz Regenerated!",description:"New questions have been generated for better learning."})},onError:t=>{console.error("Failed to regenerate quiz:",t);const d=t instanceof Error?t.message:"Unknown error",o=d.includes("quota")||d.includes("limit");c({title:"Regeneration Failed",description:o?"API quota exceeded. Please try again tomorrow or upgrade your plan.":"Could not generate new questions. Please try again.",variant:"destructive"})}}),ue=()=>{s&&v.mutate(s)};if(b)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading quiz..."})]})});if(f||!r)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(z,{className:"p-6 max-w-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Quiz Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The quiz you're looking for doesn't exist or has been removed."}),e.jsxs(w,{onClick:()=>x("/"),"data-testid":"button-back-home",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Back to Upload"]})]})})});const S=Object.keys(a).length,$=S===r.questions.length;return i&&u?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard","data-testid":"button-back",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(z,{className:"p-6 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Quiz Complete!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-primary",children:[u.percentage,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-foreground",children:[u.score,"/",u.totalQuestions]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(w,{onClick:ue,variant:"outline",disabled:v.isPending,children:v.isPending?"Generating...":"Retake Quiz"}),e.jsx(w,{onClick:()=>window.location.href="/dashboard",children:"Back to Dashboard"})]})]})}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Answer Key"}),e.jsx("div",{className:"space-y-4",children:r.questions.map((t,d)=>{const o=u.answers.find(h=>h.questionId===t.id);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-foreground",children:["Question ",d+1]}),o!=null&&o.isCorrect?e.jsx(Ie,{className:"h-5 w-5 text-green-500"}):e.jsx(Fe,{className:"h-5 w-5 text-red-500"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t.prompt}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Your Answer:"}),e.jsx("p",{className:`${o!=null&&o.isCorrect?"text-green-600":"text-red-600"}`,children:typeof(o==null?void 0:o.userAnswer)=="boolean"?o.userAnswer?"True":"False":(o==null?void 0:o.userAnswer)||"No answer"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Correct Answer:"}),e.jsx("p",{className:"text-green-600",children:typeof t.answer=="boolean"?t.answer?"True":"False":t.answer})]})]}),t.explanation&&e.jsx("div",{className:"mt-3 p-3 bg-muted rounded",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Explanation:"})," ",t.explanation]})})]},t.id)})})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard","data-testid":"button-back",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"text-primary-foreground text-sm"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"ClariTA"}),e.jsx("span",{className:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"Quiz"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[S,"/",r.questions.length," answered"]}),e.jsx(w,{onClick:N,disabled:!$,className:"min-w-[100px]",children:"Submit Quiz"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-2",children:"Quiz"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.questions.length," questions â€¢ ",((_=(L=r.meta)==null?void 0:L.countsByType)==null?void 0:_.mcq)||0," MCQ, ",((M=(O=r.meta)==null?void 0:O.countsByType)==null?void 0:M.tf)||0," True/False, ",((D=(B=r.meta)==null?void 0:B.countsByType)==null?void 0:D.fill)||0," Fill in the Blank"]})]}),e.jsx("div",{className:"space-y-6",children:r.questions.map((t,d)=>e.jsx(Me,{question:t,questionNumber:d+1,totalQuestions:r.questions.length,userAnswer:a[t.id],onAnswerChange:o=>j(t.id,o)},t.id))}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs(w,{onClick:N,disabled:!$,size:"lg",className:"min-w-[200px]",children:["Submit Quiz (",S,"/",r.questions.length,")"]})})]})]})}export{We as default};
