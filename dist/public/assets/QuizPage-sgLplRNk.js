import{c as J,u as Y,j as e,d as T,e as I,f as me,B as xe,E as pe,p as H,q as he,m as fe,r as be,I as ge}from"./ui-C--pN7N1.js";import{b as ve,u as je}from"./router-CF8zxTMD.js";import{b as Ne,u as U,c as we}from"./query-8bG1UgkI.js";import{r as p}from"./vendor-CbTYwD9p.js";import{c as W,C as z,T as ye,b as Ce,B as y,d as ke,L as E,I as Re,u as ze,a as V}from"./index-BHAYH_9x.js";import{h as Qe,Q as Se,e as A,C as Ee,i as Ae}from"./icons-BG5vJQy4.js";import{a as F}from"./api-BrMLtf3-.js";var q="Radio",[Fe,X]=J(q),[Ie,Pe]=Fe(q),Z=p.forwardRef((s,x)=>{const{__scopeRadio:a,name:d,checked:i=!1,required:m,disabled:u,value:n="on",onCheck:l,form:b,...w}=s,[r,g]=p.useState(null),h=Y(x,j=>g(j)),v=p.useRef(!1),N=r?b||!!r.closest("form"):!0;return e.jsxs(Ie,{scope:a,checked:i,disabled:u,children:[e.jsx(T.button,{type:"button",role:"radio","aria-checked":i,"data-state":te(i),"data-disabled":u?"":void 0,disabled:u,value:n,...w,ref:h,onClick:I(s.onClick,j=>{i||l==null||l(),N&&(v.current=j.isPropagationStopped(),v.current||j.stopPropagation())})}),N&&e.jsx(Te,{control:r,bubbles:!v.current,name:d,value:n,checked:i,required:m,disabled:u,form:b,style:{transform:"translateX(-100%)"}})]})});Z.displayName=q;var ee="RadioIndicator",se=p.forwardRef((s,x)=>{const{__scopeRadio:a,forceMount:d,...i}=s,m=Pe(ee,a);return e.jsx(me,{present:d||m.checked,children:e.jsx(T.span,{"data-state":te(m.checked),"data-disabled":m.disabled?"":void 0,...i,ref:x})})});se.displayName=ee;var Te=s=>{const{control:x,checked:a,bubbles:d=!0,...i}=s,m=p.useRef(null),u=xe(a),n=pe(x);return p.useEffect(()=>{const l=m.current,b=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(b,"checked").set;if(u!==a&&r){const g=new Event("click",{bubbles:d});r.call(l,a),l.dispatchEvent(g)}},[u,a,d]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:m,style:{...s.style,...n,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function te(s){return s?"checked":"unchecked"}var qe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],B="RadioGroup",[Be,He]=J(B,[H,X]),re=H(),ae=X(),[$e,Ge]=Be(B),oe=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,name:d,defaultValue:i,value:m,required:u=!1,disabled:n=!1,orientation:l,dir:b,loop:w=!0,onValueChange:r,...g}=s,h=re(a),v=he(b),[N,j]=fe({prop:m,defaultProp:i,onChange:r});return e.jsx($e,{scope:a,name:d,required:u,disabled:n,value:N,onValueChange:j,children:e.jsx(be,{asChild:!0,...h,orientation:l,dir:v,loop:w,children:e.jsx(T.div,{role:"radiogroup","aria-required":u,"aria-orientation":l,"data-disabled":n?"":void 0,dir:v,...g,ref:x})})})});oe.displayName=B;var ne="RadioGroupItem",ie=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,disabled:d,...i}=s,m=Ge(ne,a),u=m.disabled||d,n=re(a),l=ae(a),b=p.useRef(null),w=Y(x,b),r=m.value===i.value,g=p.useRef(!1);return p.useEffect(()=>{const h=N=>{qe.includes(N.key)&&(g.current=!0)},v=()=>g.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",v)}},[]),e.jsx(ge,{asChild:!0,...n,focusable:!u,active:r,children:e.jsx(Z,{disabled:u,required:m.required,checked:r,...l,...i,name:m.name,ref:w,onCheck:()=>m.onValueChange(i.value),onKeyDown:I(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:I(i.onFocus,()=>{var h;g.current&&((h=b.current)==null||h.click())})})})});ie.displayName=ne;var De="RadioGroupIndicator",le=p.forwardRef((s,x)=>{const{__scopeRadioGroup:a,...d}=s,i=ae(a);return e.jsx(se,{...i,...d,ref:x})});le.displayName=De;var ce=oe,de=ie,Le=le;const P=p.forwardRef(({className:s,...x},a)=>e.jsx(ce,{className:W("grid gap-2",s),...x,ref:a}));P.displayName=ce.displayName;const Q=p.forwardRef(({className:s,...x},a)=>e.jsx(de,{ref:a,className:W("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...x,children:e.jsx(Le,{className:"flex items-center justify-center",children:e.jsx(Qe,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Q.displayName=de.displayName;function _e({question:s,questionNumber:x,totalQuestions:a,userAnswer:d,onAnswerChange:i}){const u=(n=>{switch(n){case"mcq":return{label:"MCQ",color:"bg-blue-100 text-blue-800"};case"tf":return{label:"T/F",color:"bg-purple-100 text-purple-800"};case"fill":return{label:"Fill",color:"bg-teal-100 text-teal-800"};default:return{label:"Unknown",color:"bg-gray-100 text-gray-800"}}})(s.type);return s.answer,e.jsxs(z,{className:"p-6 fade-in","data-testid":`card-question-${s.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${u.color}`,children:u.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Question ",x," of ",a]})]}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-4","data-testid":`text-prompt-${s.id}`,children:s.prompt})]}),e.jsxs(ye,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon","data-testid":`button-citations-${s.id}`,children:e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(ke,{className:"max-w-xs",children:e.jsxs("div",{children:[e.jsx("strong",{children:"Citations:"}),s.citations.map((n,l)=>e.jsxs("div",{className:"mt-1",children:["Page ",n.page,': "',n.snippet,'"']},l))]})})]})]}),s.type==="mcq"&&s.options&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsx(P,{value:typeof d=="number"?d.toString():void 0,onValueChange:n=>i(parseInt(n)),children:s.options.map((n,l)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:l.toString(),id:`${s.id}-${l}`,className:"border-teal-600 text-teal-600 data-[state=checked]:border-teal-600 data-[state=checked]:text-teal-600"}),e.jsx(E,{htmlFor:`${s.id}-${l}`,className:"flex-1 cursor-pointer",children:n})]},l))})}),s.type==="tf"&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsxs(P,{value:typeof d=="boolean"?d.toString():void 0,onValueChange:n=>i(n==="true"),children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:"true",id:`${s.id}-true`,className:"border-teal-600 text-teal-600 data-[state=checked]:border-teal-600 data-[state=checked]:text-teal-600"}),e.jsx(E,{htmlFor:`${s.id}-true`,className:"flex-1 cursor-pointer",children:"True"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[e.jsx(Q,{value:"false",id:`${s.id}-false`,className:"border-teal-600 text-teal-600 data-[state=checked]:border-teal-600 data-[state=checked]:text-teal-600"}),e.jsx(E,{htmlFor:`${s.id}-false`,className:"flex-1 cursor-pointer",children:"False"})]})]})}),s.type==="fill"&&e.jsx("div",{className:"mb-4",children:e.jsx(Re,{placeholder:"Fill in the blank...",value:typeof d=="string"?d:"",onChange:n=>i(n.target.value),className:"w-full"})})]})}function We(){var G,D,L,_,O,M;const{quizId:s}=ve(),[,x]=je(),[a,d]=p.useState({}),[i,m]=p.useState(!1),[u,n]=p.useState(null),{toast:l}=ze(),b=Ne(),w=U({mutationFn:async t=>{console.log("Saving quiz attempt:",t);const c=await F("/api/quiz-attempts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok){let f;try{f=await c.text()}catch{f="Unknown error"}throw console.error("Failed to save quiz attempt:",c.status,f),new Error(`Failed to save quiz attempt: ${c.status} - ${f}`)}let o;try{o=await c.json(),console.log("Quiz attempt saved successfully:",o)}catch(f){throw console.error("Failed to parse response as JSON:",f),new Error("Invalid response format from server")}return o},onSuccess:t=>{console.log("Quiz attempt saved successfully:",t)},onError:t=>{console.error("Failed to save quiz attempt:",t),l({title:"Warning",description:"Quiz completed but results may not be saved properly.",variant:"destructive"})}}),{data:r,isLoading:g,error:h}=we({queryKey:["/api/quizzes",s],queryFn:async()=>{const t=await F(`/api/quizzes/${s}`);if(!t.ok)throw new Error("Failed to fetch quiz");return t.json()},enabled:!!s}),v=(t,c)=>{d(o=>({...o,[t]:c}))},N=()=>{if(!r)return;if(Object.keys(a).length<r.questions.length){l({title:"Incomplete Quiz",description:`Please answer all ${r.questions.length} questions before submitting.`,variant:"destructive"});return}let c=0;const o=r.questions.map(C=>{const k=a[C.id];let R;return C.type==="fill"&&typeof k=="string"&&typeof C.answer=="string"?R=k.toLowerCase().trim()===C.answer.toLowerCase().trim():R=JSON.stringify(k)===JSON.stringify(C.answer),R&&c++,{questionId:C.id,userAnswer:k,correctAnswer:C.answer,isCorrect:R}}),f=Math.round(c/r.questions.length*100),K={score:c,totalQuestions:r.questions.length,percentage:f,answers:o};n(K),m(!0),w.mutate({quizId:r.quizId,score:c,totalQuestions:r.questions.length,percentage:f,answers:o}),l({title:"Quiz Submitted!",description:`You scored ${c}/${r.questions.length} (${f}%)`})},j=U({mutationFn:async t=>{const c=await F(`/api/quizzes/${t}/regenerate`,{method:"POST"});if(!c.ok)throw new Error("Failed to regenerate quiz");return c.json()},onSuccess:t=>{d({}),m(!1),n(null),b.invalidateQueries({queryKey:["/api/quizzes",s]}),l({title:"Quiz Regenerated!",description:"New questions have been generated for better learning."})},onError:t=>{console.error("Failed to regenerate quiz:",t);const c=t instanceof Error?t.message:"Unknown error",o=c.includes("quota")||c.includes("limit");l({title:"Regeneration Failed",description:o?"API quota exceeded. Please try again tomorrow or upgrade your plan.":"Could not generate new questions. Please try again.",variant:"destructive"})}}),ue=()=>{s&&j.mutate(s)};if(g)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading quiz..."})]})});if(h||!r)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(z,{className:"p-6 max-w-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Quiz Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The quiz you're looking for doesn't exist or has been removed."}),e.jsxs(y,{onClick:()=>x("/"),"data-testid":"button-back-home",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Back to Upload"]})]})})});const S=Object.keys(a).length,$=S===r.questions.length;return i&&u?e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"linear-gradient(135deg, #B6E2D3 0%, #BDBFA3 50%, #B6E2D3 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-20 left-10 w-16 h-16 rounded-full",style:{backgroundColor:"#61C2A2"}}),e.jsx("div",{className:"absolute top-32 right-20 w-12 h-12 rounded-full",style:{backgroundColor:"#09224E"}}),e.jsx("div",{className:"absolute bottom-20 left-1/4 w-20 h-20 rounded-full",style:{backgroundColor:"#BDBFA3"}}),e.jsx("div",{className:"absolute bottom-32 right-1/3 w-14 h-14 rounded-full",style:{backgroundColor:"#61C2A2"}})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("header",{className:"shadow-sm",style:{backgroundColor:"#61C2A2"},children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard","data-testid":"button-back",className:"text-white hover:bg-white/20",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(V,{size:"md"}),e.jsx("h1",{className:"text-xl font-semibold text-white",children:"ClariTA"})]}),e.jsx("span",{className:"text-sm text-white/90 bg-white/20 px-2 py-1 rounded-full",children:"Quiz Results"})]})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(z,{className:"p-6 mb-6 border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#09224E"},children:"Quiz Complete!"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-primary",children:[u.percentage,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-foreground",children:[u.score,"/",u.totalQuestions]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Correct"})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(y,{onClick:ue,variant:"outline",disabled:j.isPending,children:j.isPending?"Generating...":"Retake Quiz"}),e.jsx(y,{onClick:()=>window.location.href="/dashboard",className:"hover:shadow-lg transition-all duration-200",children:"Back to Dashboard"})]})]})}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Answer Key"}),e.jsx("div",{className:"space-y-4",children:r.questions.map((t,c)=>{const o=u.answers.find(f=>f.questionId===t.id);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-foreground",children:["Question ",c+1]}),o!=null&&o.isCorrect?e.jsx(Ee,{className:"h-5 w-5 text-green-500"}):e.jsx(Ae,{className:"h-5 w-5 text-red-500"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t.prompt}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Your Answer:"}),e.jsx("p",{className:`${o!=null&&o.isCorrect?"text-green-600":"text-red-600"}`,children:typeof(o==null?void 0:o.userAnswer)=="boolean"?o.userAnswer?"True":"False":(o==null?void 0:o.userAnswer)||"No answer"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Correct Answer:"}),e.jsx("p",{className:"text-green-600",children:typeof t.answer=="boolean"?t.answer?"True":"False":t.answer})]})]}),t.explanation&&e.jsx("div",{className:"mt-3 p-3 bg-muted rounded",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Explanation:"})," ",t.explanation]})})]},t.id)})})]})]})]})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"linear-gradient(135deg, #B6E2D3 0%, #BDBFA3 50%, #B6E2D3 100%)"},children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-20 left-10 w-16 h-16 rounded-full",style:{backgroundColor:"#61C2A2"}}),e.jsx("div",{className:"absolute top-32 right-20 w-12 h-12 rounded-full",style:{backgroundColor:"#09224E"}}),e.jsx("div",{className:"absolute bottom-20 left-1/4 w-20 h-20 rounded-full",style:{backgroundColor:"#BDBFA3"}}),e.jsx("div",{className:"absolute bottom-32 right-1/3 w-14 h-14 rounded-full",style:{backgroundColor:"#61C2A2"}})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("header",{className:"shadow-sm",style:{backgroundColor:"#61C2A2"},children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>window.location.href="/dashboard","data-testid":"button-back",className:"text-white hover:bg-white/20",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(V,{size:"md"}),e.jsx("h1",{className:"text-xl font-semibold text-white",children:"ClariTA"})]}),e.jsx("span",{className:"text-sm text-white/90 bg-white/20 px-2 py-1 rounded-full",children:"Quiz"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[S,"/",r.questions.length," answered"]}),e.jsx(y,{onClick:N,disabled:!$,className:"min-w-[100px]",children:"Submit Quiz"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-2",children:"Quiz"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.questions.length," questions • ",((D=(G=r.meta)==null?void 0:G.countsByType)==null?void 0:D.mcq)||0," MCQ, ",((_=(L=r.meta)==null?void 0:L.countsByType)==null?void 0:_.tf)||0," True/False, ",((M=(O=r.meta)==null?void 0:O.countsByType)==null?void 0:M.fill)||0," Fill in the Blank"]})]}),e.jsx("div",{className:"space-y-6",children:r.questions.map((t,c)=>e.jsx(_e,{question:t,questionNumber:c+1,totalQuestions:r.questions.length,userAnswer:a[t.id],onAnswerChange:o=>v(t.id,o)},t.id))}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs(y,{onClick:N,disabled:!$,size:"lg",className:"min-w-[200px]",children:["Submit Quiz (",S,"/",r.questions.length,")"]})})]})]})]})}export{We as default};
